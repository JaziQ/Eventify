<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header(title='All Bookings (Admin)')}"></head>
<body class="d-flex flex-column min-vh-100 bg-light">

<div th:replace="~{fragments/navbar :: navbar}"></div>

<main class="flex-fill container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold">üé´ All Bookings (Admin)</h1>
        <a href="/events" class="btn btn-secondary rounded-pill shadow-sm px-4">‚¨ÖÔ∏è Back to Events</a>
    </div>

    <div th:if="${bookings != null and !bookings.isEmpty()}" class="row row-cols-1 row-cols-md-2 g-4">
        <div class="col" th:each="booking : ${bookings}">
            <div class="card shadow-sm border-0 rounded-4 h-100">
                <div class="card-body">
                    <h5 class="card-title mb-2" th:text="${booking.event.name}">Event Name</h5>
                    <p class="card-subtitle text-muted mb-3">
                        <strong>User:</strong> <span th:text="${booking.user.username}"></span>
                    </p>

                    <ul class="list-group list-group-flush mb-3 small">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <strong>Booking Status:</strong>
                            <span class="badge rounded-pill text-bg-primary" th:text="${booking.bookingStatus}"></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <strong>Ticket Code:</strong>
                            <span th:text="${booking.ticket.uniqueCode}"></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <strong>Ticket Status:</strong>
                            <span th:text="${booking.ticket.status}"
                                  th:classappend=
                                          "${booking.ticket.status
                                          == T(eventify.model.Ticket.TicketStatus).SOLD}
                                          ? 'text-danger fw-bold' : 'text-success fw-bold'"></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <strong>Date:</strong>
                            <span th:text="${#temporals.format(booking.bookingDate, 'yyyy-MM-dd HH:mm')}"></span>
                        </li>
                    </ul>

                    <div class="d-flex flex-wrap gap-2 justify-content-center mt-3">
                        <form th:action="@{/admin/bookings/tickets/{id}/toggle-status(id=${booking.ticket.id})}"
                              method="post"
                              th:if="${booking.ticket != null}"
                              style="display:inline">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit"
                                    class="btn rounded-pill px-3 shadow-sm"
                                    th:classappend="${booking.ticket.status == T(eventify.model.Ticket.TicketStatus).SOLD} ? ' btn-danger' : ' btn-success'">
                                <span th:text="${booking.ticket.status == T(eventify.model.Ticket.TicketStatus).SOLD} ? 'üîÅ Mark as CANCELLED' : 'üí∏ Mark as SOLD'"></span>
                            </button>
                        </form>


                        <a th:href="@{/admin/bookings/{id}(id=${booking.id})}"
                           class="btn btn-info rounded-pill shadow-sm px-3">
                            üëÅÔ∏è View
                        </a>

                        <a th:href="@{/admin/bookings/{id}/edit(id=${booking.id})}"
                           class="btn btn-warning rounded-pill shadow-sm px-3">
                            ‚úèÔ∏è Edit
                        </a>

                        <form th:action="@{/admin/bookings/{id}/delete(id=${booking.id})}" method="post"
                              class="d-inline">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-danger rounded-pill shadow-sm px-3">
                                üóëÔ∏è Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:if="${bookings == null or bookings.isEmpty()}" class="alert alert-info text-center shadow-sm rounded-4 mt-5">
        No bookings found.
    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
